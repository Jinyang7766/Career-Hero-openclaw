# Wave2 验收测试计划（Phase A 文件解析骨架）

> 目标：验证 Wave2 的“上传入口 + 解析状态机骨架 + 状态查询 + 回归兼容”是否满足最小可交付标准。

## 1. 测试范围

### 1.1 In Scope
- 简历文件上传接口（含基础校验）
- 解析任务状态流转（`PENDING/PROCESSING/SUCCESS/FAILED`）
- 任务状态查询接口
- 失败错误结构与错误信息可读性
- 与既有 `/api/analyze`、`/api/history` 的兼容性回归

### 1.2 Out of Scope
- 高精度 OCR/复杂版式还原质量评测
- 分布式队列与多 worker 压测
- 生产级并发容量与弹性策略

---

## 2. 测试环境与前置条件

- Backend：FastAPI 本地环境（`backend/.venv`）
- Frontend：Next.js 本地环境
- 数据库：SQLite（与当前项目默认路径一致）
- 准备测试文件：
  - `valid_resume.pdf`（合法样例）
  - `valid_resume.docx`（合法样例）
  - `invalid_resume.exe`（非法类型）
  - `oversize_resume.pdf`（超大小限制）

---

## 3. 验收测试点清单

## 3.1 上传接口

- [ ] **W2-API-001 上传成功（PDF）**
  - 步骤：上传合法 PDF
  - 期望：HTTP 2xx；返回 `taskId`；状态为 `PENDING` 或 `PROCESSING`

- [ ] **W2-API-002 上传成功（DOCX）**
  - 步骤：上传合法 DOCX
  - 期望：HTTP 2xx；返回 `taskId`

- [ ] **W2-API-003 非法文件类型**
  - 步骤：上传 `.exe` 等非法类型
  - 期望：HTTP 4xx；错误结构为 `code/message/requestId`

- [ ] **W2-API-004 文件超限**
  - 步骤：上传超限文件
  - 期望：HTTP 4xx；错误信息可读，且结构统一

## 3.2 状态查询接口

- [ ] **W2-API-005 查询已创建任务**
  - 步骤：使用有效 `taskId` 轮询状态
  - 期望：返回当前状态与元信息（如时间戳、错误字段）

- [ ] **W2-API-006 查询不存在任务**
  - 步骤：查询不存在的 `taskId`
  - 期望：HTTP 404（或约定错误码）；错误结构统一

- [ ] **W2-API-007 失败任务状态可观测**
  - 步骤：构造解析失败场景并查询
  - 期望：状态为 `FAILED`，返回可读失败原因（不暴露敏感堆栈）

## 3.3 状态流转与结果

- [ ] **W2-FLOW-001 状态流转完整性**
  - 步骤：触发一次完整流程
  - 期望：状态按约定流转，不出现非法跳转

- [ ] **W2-FLOW-002 成功结果可用于后续分析**
  - 步骤：任务成功后读取输出
  - 期望：返回结构化文本或标准化字段（允许 stub）

## 3.4 前端最小交互

- [ ] **W2-FE-001 上传后状态可见**
  - 步骤：前端发起上传
  - 期望：展示上传中/解析中/成功/失败状态

- [ ] **W2-FE-002 失败提示可理解**
  - 步骤：触发失败场景
  - 期望：前端显示用户可理解的错误提示

## 3.5 回归测试

- [ ] **W2-REG-001 analyze 回归**
  - 步骤：执行既有 `/api/analyze` 用例
  - 期望：响应结构与行为保持兼容

- [ ] **W2-REG-002 history 回归**
  - 步骤：执行既有 `/api/history` 用例
  - 期望：查询行为正常，无新增破坏

- [ ] **W2-REG-003 统一错误结构回归**
  - 步骤：触发 400/422/500 代表性错误
  - 期望：均返回 `code/message/requestId`

---

## 4. 建议自动化覆盖（pytest）

- [ ] 上传成功（PDF/DOCX）
- [ ] 非法类型/超限失败
- [ ] 任务不存在
- [ ] 任务失败返回错误原因
- [ ] analyze/history 回归冒烟

---

## 5. 通过标准（Exit Criteria）

1. P0/P1 用例全部通过（以上清单中 API、状态、回归项）。
2. Backend pytest 通过，Frontend build 通过。
3. 无阻塞级缺陷（上传不可用、状态查询不可用、错误结构破坏兼容）。
4. 测试结果可回填至 `sprint-progress.md` 的 Wave2 小节。

---

## 6. 缺陷记录模板（执行时使用）

- 缺陷编号：
- 级别（P0/P1/P2）：
- 复现步骤：
- 实际结果：
- 期望结果：
- 关联 `requestId/taskId`：
- 处理状态：
